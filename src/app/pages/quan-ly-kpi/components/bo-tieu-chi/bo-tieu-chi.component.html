<div class="py-5">
  <div class="col-md-2 col-sm-12 col-12 col-lg-12">
    <div class="label-card">
      <label class="form-label title-screen text-uppercase"> {{ 'TITLE.KPI_MANAGEMENT' | translate }} </label>
    </div>
  </div>
</div>
<div class="p-4" style="background-color: white">
  <!-- tim kiem -->
  <!-- begin: Filtration form -->
  <form action="#" class="form form-label-right" [formGroup]="searchForm">
    <div class="font-weight-bolder" style="font-size: 1.275rem">
      {{ 'BUTTON.SEARCH' | translate }}
    </div>
    <hr />
    <div class="row form-group justify-content-around">
      <label class="col-md-2 form-label col-form-label font-14" for="inputDate"
        >{{ 'TITLE.INPUT_DATE' | translate }}<span style="color: red">*</span></label
      >
      <div class="col-md-3">
        <mat-form-field appearance="fill">
          <input
            matInput
            formControlName="inputDate"
            [(ngModel)]="inputDate"
            [matDatepicker]="picker1"
            (dateChange)="eChangeDate1($event)"
            (input)="eChangeDate1($event)"
            class="w-100"
          />
          <mat-hint>DD/MM/YYYY</mat-hint>
          <mat-datepicker-toggle matIconSuffix [for]="picker1" class="icon-datePicker"></mat-datepicker-toggle>
          <mat-datepicker #picker1></mat-datepicker>
          <div style="color: red" *ngIf="t1msg != ''">
            {{ t1msg | translate }}
          </div>
        </mat-form-field>
      </div>
      <div class="col-md-2"></div>
      <div class="col-md-3"></div>
    </div>
    <div class="form-group pb-0 mt-5">
      <div class="d-flex justify-content-center">
        <div
          (click)="eSearch()"
          class="mx-3 px-8 btn btn-primary font-weight-bolder d-flex align-items-center justify-content-around"
          style="height: 38px"
        >
          <i class="mr-2 fas fa-search cursor-pointer"></i>
          {{ 'ACTION.SEARCH' | translate }}
        </div>

        <div
          (click)="eResetForm()"
          class="mx-3 px-8 btn btn-outline-primary font-weight-bolder d-flex align-items-center justify-content-around"
          style="height: 38px"
        >
          <i class="mr-2 fas fa-redo cursor-pointer"></i>
          {{ 'COMMON_BUTTON.RESET' | translate }}
        </div>
      </div>
    </div>
  </form>
</div>

<div class="p-4" style="background-color: white">
  <div class="font-weight-bolder" style="font-size: 1.275rem">
    {{ 'TITLE.INFO_KPI' | translate }}
  </div>
  <hr />
  <form class="form" [formGroup]="addEditForm">
    <div class="row form-group justify-content-around">
      <!-- beginContractDate -->
      <label class="col-md-2 form-label col-form-label font-14" for="beginContractDate"
        >{{ 'TITLE.BEGIN_CONTRACT_DATE' | translate }}<span style="color: red">*</span></label
      >
      <div class="col-md-3">
        <mat-form-field appearance="fill">
          <input
            matInput
            formControlName="beginContractDate"
            [matDatepicker]="picker2"
            (dateChange)="eChangeDate2($event)"
            (input)="eChangeDate2($event)"
            class="w-100"
          />
          <mat-hint>DD/MM/YYYY</mat-hint>
          <mat-datepicker-toggle matIconSuffix [for]="picker2" class="icon-datePicker"></mat-datepicker-toggle>
          <mat-datepicker #picker2></mat-datepicker>
          <div style="color: red" *ngIf="t2msg != ''">
            {{ t2msg | translate }}
          </div>
        </mat-form-field>
      </div>
      <!-- expiredContractDate -->
      <label class="col-md-2 form-label col-form-label font-14" for="expiredContractDate"
        >{{ 'TITLE.EXPIRED_CONTRACT_DATE' | translate }}<span style="color: red">*</span></label
      >
      <div class="col-md-3">
        <mat-form-field appearance="fill">
          <input
            matInput
            formControlName="expiredContractDate"
            (dateChange)="eChangeDate3($event)"
            (input)="eChangeDate3($event)"
            [matDatepicker]="picker3"
          />
          <mat-hint>DD/MM/YYYY</mat-hint>
          <mat-datepicker-toggle matIconSuffix [for]="picker3" class="icon-datePicker"></mat-datepicker-toggle>
          <mat-datepicker #picker3></mat-datepicker>
          <div style="color: red" *ngIf="t3msg != ''">
            {{ t3msg | translate }}
          </div>
        </mat-form-field>
      </div>
    </div>
    <div class="form-group pb-0 mt-5">
      <div class="d-flex justify-content-center">
        <div
          (click)="eDuyet()"
          class="mx-3 px-8 btn btn-primary font-weight-bolder d-flex align-items-center justify-content-around"
          style="height: 38px"
        >
          {{ 'TITLE.DUYET_KPI' | translate }}
        </div>

        <div
          (click)="eResetForm2()"
          class="mx-3 px-8 btn btn-outline-primary font-weight-bolder d-flex align-items-center justify-content-around"
          style="height: 38px"
        >
          <i class="mr-2 fas fa-redo cursor-pointer"></i>
          {{ 'COMMON_BUTTON.RESET' | translate }}
        </div>
      </div>
    </div>
  </form>
</div>

<div>
  <div class="p-4" style="background-color: white">
    <div class="text-break">
      <div class="mb-2">
        <div class="d-flex align-items-center justify-content-between">
          <div>
            <span class="" style="font-weight: 600; font-size: 1.275rem">
              {{ 'TITLE.KPI_MANAGER_CATEGORY' | translate }}
            </span>
          </div>
          <div class="d-flex align-items-center justify-content-between">
            <div (click)="eAddRoot()">
              <div
                class="ml-3 px-4 btn btn-outline-primary font-weight-bolder d-flex align-items-center"
                style="height: 38px"
              >
                <i class="fas fa-plus mr-2" style="color: green"></i>
                {{ 'TITLE.ADD_ROOT_KPI' | translate }}
              </div>
            </div>
            <div (click)="eSaveAll()">
              <div
                class="ml-3 px-4 btn btn-outline-primary font-weight-bolder d-flex align-items-center"
                style="height: 38px"
              >
                <i class="fas fa-save mr-2" style="color: green"></i>
                {{ 'TITLE.SAVE_KPI' | translate }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="mat-elevation-z8" style="overflow-x: scroll; width: 100%">
    <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
      <ng-container matColumnDef="kpiName">
        <th class="" mat-header-cell *matHeaderCellDef>
          <span style="width: max-content" [style.paddingLeft.px]="40"> {{ 'TITLE.NAME_KPI' | translate }} </span>
        </th>
        <td class="text-left" mat-cell *matCellDef="let data">
          <div style="width: max-content">
            <button
              mat-icon-button
              [style.visibility]="!data.expandable ? 'hidden' : ''"
              [style.marginLeft.px]="data.level * 32"
              (click)="treeControl.toggle(data)"
            >
              <mat-icon class="mat-icon-rtl-mirror">
                {{ treeControl.isExpanded(data) ? 'expand_more' : 'chevron_right' }}
              </mat-icon>
            </button>
            {{ data.kpiName }}
          </div>
        </td>
      </ng-container>
      <ng-container matColumnDef="kpiNameVi">
        <th mat-header-cell *matHeaderCellDef>{{ 'TITLE.KPI_NAME_VI' | translate }}</th>
        <td mat-cell *matCellDef="let data">{{ data.kpiNameVi }}</td>
      </ng-container>
      <ng-container matColumnDef="kpiNameLa">
        <th mat-header-cell *matHeaderCellDef>{{ 'TITLE.KPI_NAME_LA' | translate }}</th>
        <td mat-cell *matCellDef="let data">{{ data.kpiNameLa }}</td>
      </ng-container>
      <ng-container matColumnDef="contentVi">
        <th mat-header-cell *matHeaderCellDef>{{ 'TITLE.CONTENT_VI' | translate }}</th>
        <td mat-cell *matCellDef="let data">{{ data.contentVi }}</td>
      </ng-container>
      <ng-container matColumnDef="contentLa">
        <th mat-header-cell *matHeaderCellDef>{{ 'TITLE.CONTENT_LA' | translate }}</th>
        <td mat-cell *matCellDef="let data">{{ data.contentLa }}</td>
      </ng-container>
      <ng-container matColumnDef="kpiPolicyVi">
        <th mat-header-cell *matHeaderCellDef>{{ 'TITLE.KPI_POLICY_VI' | translate }}</th>
        <td mat-cell *matCellDef="let data">{{ data.kpiPolicyVi }}</td>
      </ng-container>
      <ng-container matColumnDef="kpiPolicyLa">
        <th mat-header-cell *matHeaderCellDef>{{ 'TITLE.KPI_POLICY_LA' | translate }}</th>
        <td mat-cell *matCellDef="let data">{{ data.kpiPolicyLa }}</td>
      </ng-container>
      <ng-container matColumnDef="staffCode">
        <th mat-header-cell *matHeaderCellDef>{{ 'TITLE.STAFF_CODE' | translate }}</th>
        <td mat-cell *matCellDef="let data">{{ data.staffCode }}</td>
      </ng-container>
      <ng-container matColumnDef="kpiPoint">
        <th mat-header-cell *matHeaderCellDef>{{ 'TITLE.KPI_POINT' | translate }}</th>
        <td mat-cell *matCellDef="let data">{{ data.kpiPoint }}</td>
      </ng-container>
      <!-- action -->
      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef>
          {{ 'LABEL.ACTION' | translate }}
        </th>
        <td mat-cell *matCellDef="let item">
          <div style="min-width: 100px" class="d-flex justify-content-around">
            <div>
              <i
                (click)="eAdd(item); $event.stopPropagation()"
                data-toggle="tooltip"
                data-placement="top"
                [title]="'FUNCTION.ADD_THIS_KPI' | translate"
                class="fas fa-plus fa-lg p-0 text-primary text-hover-danger cursor-pointer"
              ></i>
            </div>
            <div>
              <i
                (click)="eUpdate(item); $event.stopPropagation()"
                data-toggle="tooltip"
                data-placement="top"
                [title]="'FUNCTION.UPDATE' | translate"
                class="fas fa-edit fa-lg p-0 text-warning text-hover-danger cursor-pointer"
              ></i>
            </div>
            <div (click)="eDelete(item); $event.stopPropagation()">
              <i
                data-toggle="tooltip"
                data-placement="top"
                [title]="'TOOLTIP.DELETE' | translate"
                class="fas fa-trash p-0 icon-view-detail text-warning text-hover-danger"
              ></i>
            </div>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns" class="blue-row zindex-5"></tr>
    </table>
  </div>
  <div class="pb-1"></div>
  <ngx-spinner bdColor="rgba(0, 0, 0, 0.8)" size="medium" color="#fff" type="square-jelly-box" [fullScreen]="false"
    ><p style="color: white">Loading...</p></ngx-spinner
  >
</div>
